!function($app){var patternFormat=function(e){return e?$(e).attr("format")||"DD/MM/YYYY":"DD/MM/YYYY"},parsePermission=function(e){var t={visible:{public:!0},enabled:{public:!0}};if(e)for(var i=e.toLowerCase().trim().split(","),n=0;n<i.length;n++){var r=i[n].trim();if(r){var a=r.split(":");if(2==a.length){var l=a[0].trim(),o=a[1].trim();if(o){for(var s=o.split(";"),c={},d=0;d<s.length;d++){var p=s[d].trim();p&&(c[p]=!0)}t[l]=c}}}}return t};app.directive("asDate",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,i,n){function r(){var e=t.val(),i=moment(e,patternFormat(t));i.isValid()&&n.$setViewValue(i.toDate())}if(n){var a=patternFormat(t),l={format:a,locale:"pt-BR",showTodayButton:!0,useStrict:!0,tooltips:{today:"Hoje",clear:"Limpar seleção",close:"Fechar",selectMonth:"Selecionar mês",prevMonth:"Mês anterior",nextMonth:"Próximo mês",selectYear:"Selecionar ano",prevYear:"Ano anterior",nextYear:"Próximo ano",selectDecade:"Selecionar década",prevDecade:"Década anterior",nextDecade:"Próxima década",prevCentury:"Século anterior",nextCentury:"Próximo século"}};"DD/MM/YYYY"!=a&&(l.sideBySide=!0),t.datetimepicker(l),t.on("dp.change",function(){$(this).is(":visible")&&($(this).trigger("change"),e.$apply(r))}),n.$render=function(){if(n.$viewValue){var e=moment(n.$viewValue);if(e.isValid())t.val(e.format(patternFormat(t)));else{var i=parseInt(n.$viewValue,10);e=moment(i),e.isValid()?t.val(e.format(patternFormat(t))):t.val("")}}else t.data("DateTimePicker").clear(),t.val("")},r()}}}}).directive("ngDestroy",function(){return{restrict:"A",link:function(scope,element,attrs,ctrl){element.on("$destroy",function(){attrs.ngDestroy&&attrs.ngDestroy.length>0&&(attrs.ngDestroy.indexOf("app.")>-1||attrs.ngDestroy.indexOf("blockly.")>-1?scope.$eval(attrs.ngDestroy):eval(attrs.ngDestroy))})}}}).directive("dynamicImage",["$compile",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"@",width:"@",height:"@",style:"@",class:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel=""),e.width||(e.width="128"),e.height||(e.height="128"),e.style||(e.style=""),e.class||(e.class=""),this.containsLetter(e.width)||(e.width+="px"),this.containsLetter(e.height)||(e.height+="px")},containsLetter:function(e){for(var t,i=0;i<e.length;i++){t=!0;for(var n=0;n<10;n++)parseInt(e[i])==n&&(t=!1);if(t)break}return t},link:function(t,i,n){this.init(t);var r=t;i.append('<div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                  <img class="$class$" style="$style$; height: $height$; width: $width$;" ng-if="$ngModel$" data-ng-src="{{$ngModel$.startsWith(\'http\') || ($ngModel$.startsWith(\'/\') && $ngModel$.length < 1000)? $ngModel$ : \'data:image/png;base64,\' + $ngModel$}}">                                  <img class="$class$" style="$style$; height: $height$; width: $width$;" ng-if="!$ngModel$" data-ng-src="/plugins/cronapp-framework-js/img/selectImg.svg" class="btn" ng-if="!$ngModel$" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.setFile(\'$ngModel$\', $file)" accept="image/*;capture=camera">                                  <div class="remove btn btn-danger btn-xs" ng-if="$ngModel$" ng-click="$ngModel$=null">                                    <span class="glyphicon glyphicon-remove"></span>                                  </div>                                  <div class="btn btn-info btn-xs start-camera-button" ng-if="!$ngModel$" ng-click="cronapi.internal.startCamera(\'$ngModel$\')">                                    <span class="glyphicon glyphicon-facetime-video"></span>                                  </div>                                </div>'.split("$height$").join(r.height).split("$width$").join(r.width).split("$ngModel$").join(r.ngModel).split("$style$").join(r.style).split("$class$").join(r.class)),e(i)(i.scope())}}}]).directive("dynamicFile",["$compile",function(e){return{restrict:"E",replace:!0,scope:{ngModel:"@"},require:"ngModel",template:"<div></div>",init:function(e){e.ngModel||(e.ngModel="")},link:function(t,i,n){this.init(t);var r=t,a=r.ngModel.split("."),l=a[0],o=a[a.length-1],s=Math.floor(1e3*Math.random()+20);i.append('<div ng-show="!$ngModel$">                                  <div class="form-group upload-image-component" ngf-drop="" ngf-drag-over-class="dragover">                                     <img class="ng-scope" style="height: 128px; width: 128px;" ng-if="!$ngModel$" data-ng-src="/plugins/cronapp-framework-js/img/selectFile.png" ngf-drop="" ngf-select="" ngf-change="cronapi.internal.uploadFile(\'$ngModel$\', $file, \'uploadprogress$number$\')" accept="*">                                    <progress id="uploadprogress$number$" max="100" value="0" style="position: absolute; width: 128px; margin-top: -134px;">0</progress>                                  </div>                                </div>                                 <div ng-show="$ngModel$" class="form-group upload-image-component">                                   <div class="btn btn-danger btn-xs ng-scope" style="float:right;" ng-if="$ngModel$" ng-click="$ngModel$=null">                                     <span class="glyphicon glyphicon-remove"></span>                                   </div>                                   <div>                                     <div ng-bind-html="cronapi.internal.generatePreviewDescriptionByte($ngModel$)"></div>                                     <a href="javascript:void(0)" ng-click="cronapi.internal.downloadFileEntity($datasource$,\'$field$\')">download</a>                                   </div>                                 </div> '.split("$ngModel$").join(r.ngModel).split("$datasource$").join(l).split("$field$").join(o).split("$number$").join(s)),e(i)(i.scope())}}}]).directive("pwCheck",[function(){"use strict";return{require:"ngModel",link:function(e,t,i,n){var r="#"+i.pwCheck;t.add(r).on("keyup",function(){e.$apply(function(){var e=t.val()===$(r).val();n.$setValidity("pwmatch",e)})})}}}]).directive("valid",function(){return{require:"^ngModel",restrict:"A",link:function(e,t,i,n){var r={cpf:CPF,cnpj:CNPJ};n.$validators[i.valid]=function(e,n){var a=e||n,l=r[i.valid].isValid(a);return l?t[0].setCustomValidity(""):t[0].setCustomValidity(t[0].dataset.errorMessage),l||!a}}}}).directive("cronappSecurity",function(){return{restrict:"A",link:function(e,t,i){var n=[];e.session&&e.session.roles&&(n=e.session.roles.toLowerCase().split(","));for(var r=parsePermission(i.cronappSecurity),a=!1,l=!1,o=0;o<n.length;o++){var s=n[o].trim();s&&(r.visible[s]&&(a=!0),r.enabled[s]&&(l=!0))}a||$(t).hide(),l||$(t).find("*").addBack().attr("disabled",!0)}}}).directive("uiSelect",["$compile",function(e){return{restrict:"E",require:"ngModel",link:function(t,i,n,r){if(void 0!=n.required||"true"===n.ngRequired){$(i).append('<input autocomplete="off" tabindex="-1" class="uiSelectRequired ui-select-offscreen" style="left: 50%!important; top: 100%!important;" type=text ng-model="'+n.ngModel+'" required>');var a=$(i).find("input.uiSelectRequired");e(a)(i.scope())}}}}]).filter("mask",function(){return function(e,t){var i=$('<input type="text">');return e instanceof Date?moment(e).format(t):(i.mask(t),i.masked(e))}}).directive("mask",["$compile",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,i,n){var r=$(t),a=r.attr("type");r.attr("type","text"),n.$formatters=[],n.$parsers=[];var l=!1;i.mask.endsWith(";0")&&(l=!0);var o=i.mask.replace(";1","").replace(";0","").trim();if("date"==a||"datetime-local"==a){var s={format:o,locale:"pt-BR",showTodayButton:!0,useStrict:!0,tooltips:{today:"Hoje",clear:"Limpar seleção",close:"Fechar",selectMonth:"Selecionar mês",prevMonth:"Mês anterior",nextMonth:"Próximo mês",selectYear:"Selecionar ano",prevYear:"Ano anterior",nextYear:"Próximo ano",selectDecade:"Selecionar década",prevDecade:"Década anterior",nextDecade:"Próxima década",prevCentury:"Século anterior",nextCentury:"Próximo século"}};"DD/MM/YYYY"!=o&&(s.sideBySide=!0),r.datetimepicker(s),r.on("dp.change",function(){$(this).is(":visible")&&($(this).trigger("change"),e.$apply(function(){var e=r.val(),t=moment(e,o);t.isValid()&&n.$setViewValue(t.toDate())}))}),n.$formatters.push(function(e){return moment(e).format(o)}),n.$parsers.push(function(e){return moment(e,o).toDate()})}else if("number"==a){l=!0,!1;var c=o.trim().replace(/\./g,"").replace(/\,/g,"").replace(/#/g,"").replace(/0/g,"").replace(/9/g,""),d="",p="",u="",g=",",m=0;o.startsWith(c)?d=c:o.endsWith(c)&&(p=c);var v=o.trim().replace(d,"").replace(p,"").trim();v.startsWith("#.")?u=".":v.startsWith("#,")&&(u=",");var f=null;if(-1!=v.indexOf(",0")?(g=",",f=",0"):-1!=v.indexOf(".0")&&(g=".",f=".0"),null!=f){var h=v.substring(v.indexOf(f)+1);m=h.length}$(t).maskMoney({allowZero:!1,prefix:d,suffix:p,allowNegative:!0,thousands:u,decimal:g,precision:m}),n.$formatters.push(function(e){return r.maskMoney("mask",e),r.val()}),n.$parsers.push(function(e){return r.maskMoney("unmasked")[0]})}else"text"==a&&(r.mask(o),l&&(n.$formatters.push(function(e){return r.masked(e)}),n.$parsers.push(function(e){return r.cleanVal()})))}}}]).directive("cronappFilter",function(){return{restrict:"A",link:function(scope,element,attrs){var typeElement=$(element).attr("type");void 0!=attrs.asDate&&(typeElement="date");var filterTemplate="",filtersSplited=attrs.cronappFilter.split(";");$(filtersSplited).each(function(){this.length>0&&(filterTemplate+="text"==typeElement?this+"@=%{value}%;":this+"={value};")}),filterTemplate=filterTemplate.length>0?filterTemplate.substr(0,filterTemplate.length-1):"%{value}%","text"==typeElement?$(element).on("keyup",function(){var datasource=eval(attrs.crnDatasource),bindedFilter=filterTemplate.split("{value}").join(this.value);0==this.value.length&&(bindedFilter=""),datasource.search(bindedFilter)}):$(element).on("change",function(){var datasource=eval(attrs.crnDatasource),value=void 0,typeElement=$(this).attr("type");if(void 0!=attrs.asDate&&(typeElement="date"),"checkbox"==typeElement)value=$(this).is(":checked");else if("date"==typeElement){if(value=this.value,this.value.length>0){var momentDate=moment(this.value,patternFormat(this));value=momentDate.toDate().toISOString()}}else value=this.value;var bindedFilter=filterTemplate.split("{value}").join(value);0==value.toString().length&&(bindedFilter=""),datasource.search(bindedFilter)})}}})}(app);